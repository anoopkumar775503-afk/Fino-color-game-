<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fino Color Game - Full App</title>
    <style>
        :root { --primary: #009688; --secondary: #00796b; --red: #f44336; --green: #4caf50; --violet: #9c27b0; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; margin: 0; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 450px; background: white; min-height: 100vh; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
        .p-20 { padding: 20px; }
        
        /* Auth Styles */
        .auth-card { padding: 40px 20px; text-align: center; }
        .tabs { display: flex; margin-bottom: 20px; border: 1px solid var(--primary); border-radius: 8px; overflow: hidden; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: #eee; cursor: pointer; font-weight: bold; }
        .active-tab { background: var(--primary); color: white; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-main { background: var(--primary); color: white; }

        /* Dashboard Styles */
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; border-radius: 0 0 25px 25px; }
        .wallet-card { background: var(--secondary); margin: -30px 20px 20px; padding: 20px; border-radius: 15px; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); text-align: center; }
        
        /* Game Area */
        .game-info { display: flex; justify-content: space-between; background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #eee; }
        .color-btns { display: flex; gap: 10px; margin: 15px 0; }
        .c-btn { flex: 1; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .num-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-top: 10px; }
        .n-btn { padding: 12px; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; }
        
        /* Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: flex-end; z-index: 1000; }
        .modal-body { background: white; width: 100%; border-radius: 20px 20px 0 0; padding: 25px; box-sizing: border-box; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* History */
        .history-tabs { display: flex; background: #eee; margin-top: 20px; }
        .h-tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; font-size: 14px; }
        .active-h { border-bottom: 3px solid var(--primary); color: var(--primary); font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="auth-screen" class="auth-card">
        <h1 style="color:var(--primary)">FINO</h1>
        <div class="tabs">
            <button id="t-login" class="tab-btn active-tab" onclick="toggleAuth('login')">लॉगिन</button>
            <button id="t-reg" class="tab-btn" onclick="toggleAuth('reg')">रजिस्ट्रेशन</button>
        </div>

        <div id="login-box">
            <input type="tel" id="l-phone" placeholder="मोबाइल नंबर">
            <input type="password" id="l-pass" placeholder="पासवर्ड">
            <button class="btn btn-main" onclick="loginWithPass()">लॉगिन करें</button>
            <p>या</p>
            <div id="recaptcha-login"></div>
            <button class="btn" style="border:1px solid var(--primary)" onclick="sendOTP('login')">OTP से लॉगिन</button>
        </div>

        <div id="reg-box" class="hidden">
            <input type="text" id="r-name" placeholder="पूरा नाम">
            <input type="tel" id="r-phone" placeholder="मोबाइल नंबर (+91...)">
            <input type="password" id="r-pass" placeholder="पासवर्ड बनाएं">
            <div id="recaptcha-reg"></div>
            <button class="btn btn-main" onclick="sendOTP('reg')">OTP भेजें</button>
        </div>

        <div id="otp-confirm" class="hidden">
            <input type="number" id="otp-input" placeholder="6-अंकों का OTP">
            <button class="btn btn-main" onclick="verifyOTP()">Verify OTP</button>
        </div>
    </div>

    <div id="dashboard" class="hidden">
        <div class="header">
            <h3>FINO PREMIUM</h3>
            <button onclick="location.reload()" style="background:none; border:1px solid white; color:white; border-radius:5px">Logout</button>
        </div>
        <div class="wallet-card">
            <small>Total Balance</small>
            <h2 id="u-balance">₹ 0.00</h2>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn" style="background:var(--red); flex:1; color:white;" onclick="alert('Recharge Feature coming soon')">Recharge</button>
                <button class="btn" style="background:white; flex:1; color:var(--primary);" onclick="alert('Withdraw coming soon')">Withdraw</button>
            </div>
        </div>

        <div class="p-20">
            <div class="game-info">
                <span>Period ID<br><strong>2026020101</strong></span>
                <span style="text-align:right">Time Left<br><strong id="timer" style="color:var(--red); font-size:18px">03:00</strong></span>
            </div>

            <div class="color-btns">
                <button class="c-btn" style="background:var(--green)" onclick="openModal('Green')">Green</button>
                <button class="c-btn" style="background:var(--violet)" onclick="openModal('Violet')">Violet</button>
                <button class="c-btn" style="background:var(--red)" onclick="openModal('Red')">Red</button>
            </div>

            <div class="num-grid">
                <button class="n-btn" style="background:linear-gradient(to right, var(--violet), var(--red))" onclick="openModal(0)">0</button>
                <button class="n-btn" style="background:var(--green)" onclick="openModal(1)">1</button>
                <button class="n-btn" style="background:var(--red)" onclick="openModal(2)">2</button>
                <button class="n-btn" style="background:var(--green)" onclick="openModal(3)">3</button>
                <button class="n-btn" style="background:var(--red)" onclick="openModal(4)">4</button>
                <button class="n-btn" style="background:linear-gradient(to right, var(--violet), var(--green))" onclick="openModal(5)">5</button>
                <button class="n-btn" style="background:var(--red)" onclick="openModal(6)">6</button>
                <button class="n-btn" style="background:var(--green)" onclick="openModal(7)">7</button>
                <button class="n-btn" style="background:var(--red)" onclick="openModal(8)">8</button>
                <button class="n-btn" style="background:var(--green)" onclick="openModal(9)">9</button>
            </div>
        </div>

        <div class="history-tabs">
            <div class="h-tab active-h" onclick="loadHistory('game')">गेम रिकॉर्ड</div>
            <div class="h-tab" onclick="loadHistory('wallet')">वॉलेट रिकॉर्ड</div>
        </div>
        <div id="h-content" class="p-20"></div>
    </div>

    <div id="bet-modal" class="modal hidden">
        <div class="modal-body">
            <h3 id="m-title">Join Green</h3>
            <p>Select Amount:</p>
            <div style="display:flex; gap:5px; margin-bottom:15px;">
                <button onclick="setBet(10)" style="flex:1">10</button>
                <button onclick="setBet(100)" style="flex:1">100</button>
                <button onclick="setBet(1000)" style="flex:1">1000</button>
            </div>
            <input type="number" id="m-amount" value="10">
            <button class="btn btn-main" onclick="confirmBet()">Confirm Bet</button>
            <button class="btn" onclick="closeModal()">Cancel</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>

<script>
    // --- Firebase Configuration ---
    const firebaseConfig = {
  apiKey: "AIzaSyDsAQlJNaWRK6xf7Kx1Ac8Y6hObuY8sBbw",
  authDomain: "fino-color.firebaseapp.com",
  projectId: "fino-color",
  storageBucket: "fino-color.firebasestorage.app",
  messagingSenderId: "686498750999",
  appId: "1:686498750999:web:e21edc0746eeaab3067252"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ReCaptcha
    window.recaptchaReg = new firebase.auth.RecaptchaVerifier('recaptcha-reg', {size: 'invisible'});
    window.recaptchaLogin = new firebase.auth.RecaptchaVerifier('recaptcha-login', {size: 'invisible'});

    let currentMode = 'login';
    let currentUid = '';
    let selectedBet = '';

    // UI Functions
    function toggleAuth(mode) {
        currentMode = mode;
        document.getElementById('login-box').classList.toggle('hidden', mode === 'reg');
        document.getElementById('reg-box').classList.toggle('hidden', mode === 'login');
        document.getElementById('t-login').classList.toggle('active-tab', mode === 'login');
        document.getElementById('t-reg').classList.toggle('active-tab', mode === 'reg');
    }

    // Auth Logic
    function sendOTP(type) {
        const phone = type === 'reg' ? document.getElementById('r-phone').value : document.getElementById('l-phone').value;
        const verifier = type === 'reg' ? window.recaptchaReg : window.recaptchaLogin;
        
        auth.signInWithPhoneNumber(phone, verifier).then(res => {
            window.confirmResult = res;
            document.getElementById('login-box').classList.add('hidden');
            document.getElementById('reg-box').classList.add('hidden');
            document.getElementById('otp-confirm').classList.remove('hidden');
            alert("OTP Sent!");
        }).catch(err => alert(err.message));
    }

    function verifyOTP() {
        const otp = document.getElementById('otp-input').value;
        confirmResult.confirm(otp).then(res => {
            currentUid = res.user.uid;
            if(currentMode === 'reg') {
                const name = document.getElementById('r-name').value;
                const pass = document.getElementById('r-pass').value;
                const phone = document.getElementById('r-phone').value;
                db.collection("users").doc(currentUid).set({
                    uid: currentUid, name, phone, password: pass, balance: 0, role: 'user'
                }).then(() => loadUser(currentUid));
            } else {
                loadUser(currentUid);
            }
        }).catch(() => alert("Wrong OTP"));
    }

    function loginWithPass() {
        const phone = document.getElementById('l-phone').value;
        const pass = document.getElementById('l-pass').value;
        db.collection("users").where("phone","==",phone).where("password","==",pass).get().then(snap => {
            if(!snap.empty) loadUser(snap.docs[0].id);
            else alert("Invalid Details");
        });
    }

    function loadUser(uid) {
        currentUid = uid;
        db.collection("users").doc(uid).onSnapshot(doc => {
            const data = doc.data();
            document.getElementById('u-balance').innerText = "₹ " + data.balance.toFixed(2);
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
        });
        loadHistory('game');
    }

    // Game Logic
    function openModal(val) {
        selectedBet = val;
        document.getElementById('m-title').innerText = "Join " + val;
        document.getElementById('bet-modal').classList.remove('hidden');
    }
    function closeModal() { document.getElementById('bet-modal').classList.add('hidden'); }
    function setBet(amt) { document.getElementById('m-amount').value = amt; }

    function confirmBet() {
        const amt = parseInt(document.getElementById('m-amount').value);
        db.collection("users").doc(currentUid).get().then(doc => {
            if(doc.data().balance < amt) return alert("Low Balance!");
            
            db.collection("users").doc(currentUid).update({
                balance: firebase.firestore.FieldValue.increment(-amt)
            }).then(() => {
                db.collection("game_history").add({
                    uid: currentUid, amount: amt, betOn: selectedBet, status: "Pending", time: new Date()
                });
                alert("Bet Placed!");
                closeModal();
            });
        });
    }

    // History
    function loadHistory(type) {
        const coll = type === 'game' ? 'game_history' : 'wallet_history';
        db.collection(coll).where("uid","==",currentUid).limit(10).get().then(snap => {
            let h = `<table><tr><th>Item</th><th>Amt</th><th>Status</th></tr>`;
            snap.forEach(doc => {
                const d = doc.data();
                h += `<tr><td>${d.betOn || 'Recharge'}</td><td>₹${d.amount}</td><td>${d.status}</td></tr>`;
            });
            h += `</table>`;
            document.getElementById('h-content').innerHTML = h;
        });
    }

    // Timer (Simple)
    setInterval(() => {
        let now = new Date();
        let sec = 60 - now.getSeconds();
        document.getElementById('timer').innerText = "00:" + (sec < 10 ? "0" + sec : sec);
    }, 1000);

</script>
</body>
</html>
